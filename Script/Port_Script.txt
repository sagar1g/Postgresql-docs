#!/bin/bash

##### Change this section only as per every customers information requirement
## ----------------------------------------------------
CUST_ID="126110573"
PIN="5357"
From_email="nttin.operations.database@global.ntt"
To_email="svc.nttin.ngaalerts.snoc@global.ntt"
smtp_server="202.87.39.93"
hostname=`mcollect-Bank-Prod-DB2`
IP="142.79.238.120"
DB_PORT="5432"
#DB_PORT2="3308"          ## if instance is running on more than 2 ports

## ----------------------------------------------------

USER=nagios_mk
MYSQLPASSWORD='Monitoring$!23'

mkdir -p "/home/infra.mg/scripts/monitor/monitor_DB_HOST"
outputfile="/home/infra.mg/scripts/monitor/monitor_DB_HOST/system_details.txt"
LOCATION=/home/infra.mg/scripts/


echo $IP

> $outputfile
#--------------------------------------------
##POSTGRE SQL port is listening or not

#Service=`netstat -ntlp | grep 5432 | awk '{print $6}'| head -1`
Service=`netstat -ntlp | grep postmaster |grep $DB_PORT | awk '{print $6}'| head -1`
if [ "$Service" = 'LISTEN' ];
then
        echo "PostgreSQL Port is running"
else
        echo CUST ID : $CUST_ID                                                         >> $outputfile
        echo PIN : $PIN                                                                 >> $outputfile
        echo "  "                                                                       >> $outputfile
        echo "PostgreSQL Port is not running on (server ip = $IP - $hostname )"              >> $outputfile
        echo "`cat $outputfile`"  | /home/infra.mg/scripts/sendEmail -f "$From_email" -t "nttin.db.postgresql@global.ntt" -t "$To_email" -u "CUST ID : $CUST_ID|| PostgreSQL_DB Port is not Running on Server $IP / $hostname " -s "$smtp_server:25"
fi
