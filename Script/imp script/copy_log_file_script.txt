#!/bin/bash
# Define the source and destination directories and machine details
YESTERDAY_DATE=$(date -d "yesterday" '+%Y-%m-%d')
SOURCE_DIR="/home/pgsql/13/data/log"
SOURCE_USER="root"
SOURCE_HOST="10.12.0.11"
>/home/shell_script/postgres_log/logfile_trasfer_success.txt
>/home/shell_script/postgres_log/logfile_trasfer_error.txt
DEST_DIR="/home/logs_postgresdb/"

# Get the current date in YYYY-MM-DD format
#CURRENT_DATE=$(date +%Y-%m-%d)
echo "Log of Date = $YESTERDAY_DATE is only copied for file name"
# Define the filename pattern
FILENAME="${YESTERDAY_DATE}*"
# Define the log file name
# Copy the file from the source machine to the destination machine using SCP with SSH key authentication
if  scp "${SOURCE_USER}@${SOURCE_HOST}:${SOURCE_DIR}/${FILENAME}" "${DEST_DIR}" >> /home/shell_script/postgres_log/logfile_trasfer_success.txt ; then
        echo "$(date '+%Y-%m-%d %H:%M:%S') ${FILENAME} SUCCESSFULLY copied to ${DEST_DIR}" >> /home/shell_script/postgres_log/logfile_trasfer_success.txt
        echo "To check log files : cd /home/logs_postgresdb/"
        end_time=$(date '+%Y-%m-%d %H:%M:%S')
        echo "Copying postgres log is completed at $end_time" >> /home/shell_script/postgres_log/logfile_trasfer_success.txt
# Check if the copy was successful and log the result
else
        echo "$(date '+%Y-%m-%d %H:%M:%S') - FAILED: ${SOURCE_USER}@${SOURCE_HOST}:${SOURCE_DIR}/${FILENAME} could not be copied to ${DEST_DIR}" >> /home/shell_script/postgres_log/logfile_trasfer_error.txt
        end_time=$(date '+%Y-%m-%d %H:%M:%S')
        echo "Copying postgres log is failed and time was $end_time" >> /home/shell_script/postgres_log/logfile_trasfer_error.txt
fi
